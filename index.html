<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Big Bubble!</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <style>
            body {
                background:#000;
                padding:0;
                margin:0;
                font-weight: bold;
                overflow:hidden;
            }

            #game {
                margin:20px auto 40px;
                border:1px solid #fff;
            }
            a {    color: #ffffff;    }

            #oldie a { color:#0b0 }
        </style>
    </head>

    <body>
<div id="game"></div>
<div id="vshader">

          varying vec2 vUv;
          varying float posz;
          varying float posy;
          varying float posx;

          void main() {
              vUv = uv;
              posx = position.x;
              posy = position.y;
              posz = position.z;
              vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
              gl_Position = projectionMatrix * mvPosition;
          }

      </div>
      <div id="fshader">

uniform vec2 resolution;
uniform vec3 beamColor;
uniform vec3 bgColor;
uniform float time;
uniform float beamSpeed;
uniform int numBeams;
uniform float brightness;
uniform float slantBrightness;
uniform float dModifier;

#define PI 3.1416

vec3 dir(vec3 pos, float rotation) {
    return vec3(800,100,0);
}

#ifdef GL_ES
precision mediump float;
#endif


bool leftToRight = false;
float slopeSign = (leftToRight ? -1.0 : 1.0);
float slope1 = 8.0 * slopeSign;
float slope2 = 7.0 * slopeSign;

void main(void) {
    vec2 p = (gl_FragCoord.xy) / resolution.xy;
    p.x += 0.6;
    p.y -= 0.6;
    vec2 center = vec2(0.5, 0.5);
    float d = distance(p, center) - dModifier;
        
    // bluish tint from top left
    vec3 color = bgColor;//vec3(1.0 - d * 0.75) * vec3(0.03, 0.35, 1.0);
    
    // add some green near centre
    color += (1.0-distance(p, vec2(1.0, 1.0))*1.) * 0.5 * vec3(0.35, 0.65, 0.45);
    
    vec3 lightColor = beamColor;
    
    // will be better as uniforms
    for (int i=0; i < numBeams; i++) {
        // direction of light
        float zr = sin(time * beamSpeed * float(i)) * 0.5 - PI/3.0;
        vec3 dir = vec3(cos(zr), sin(zr), 0.0);
        
        p.x -= (float(i) / float(numBeams)) * 1.0;
        
        // normalized spotlight vector
        vec3 SpotDir = normalize(dir);
        
        vec3 attenuation = vec3(0.5, 7.0, 10.0);
        float shadow = brightness / (attenuation.x + (attenuation.y * d) + (attenuation.z * d * d));

        vec3 pos = vec3(p, 0.0);
        vec3 delta = normalize(pos - vec3(center, 0.0));
        
        float cosOuterCone = cos(radians(1.0));
        float cosInnerCone = cos(radians(15.0 + float(i * 2)));
        float cosDirection = dot(delta, SpotDir);
        
        // light...
        color += smoothstep(cosInnerCone, cosOuterCone, cosDirection) * shadow * lightColor;
    }
    color += sin(time * 0.5) * 0.05;





    
    
    // https://www.shadertoy.com/view/4sX3Wr
    vec2 uv = gl_FragCoord.xy / resolution.xy;
    float bright =
        - sin(uv.y * slope1 + uv.x * 30.0+ time *3.10) *.2
        - sin(uv.y * slope2 + uv.x * 37.0 + time *3.10) *.1
        - cos(              + uv.x * 2.0 * slopeSign + time *2.10) *.1
        - sin(              - uv.x * 5.0 * slopeSign + time * 2.0) * .3;
    
    float modulate = abs(cos(time * .1) * 0.1 + sin(time * .7)) * 0.5;
    bright *= modulate;
    vec4 pix = vec4(beamColor.r, beamColor.g, beamColor.b, 1.0);
    pix += clamp(bright / 1.0, 0.0, 1.0);

    gl_FragColor = vec4(vec3(color), 1.0) + ( slantBrightness * pix );


}

  
</div>


        <script src="js/q.min.js"></script>
        <script src="js/three.min.js"></script>
        <script src="js/jquery-2.0.0.min.js"></script>
        <script src="js/mousetrap.min.js"></script>
        <script src="js/FresnelShader.js"></script>
        <script src="js/Detector.js"></script>
        <script src="js/bubble.js"></script>
    </body>
</html>
